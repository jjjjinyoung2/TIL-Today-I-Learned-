상태란 ?

: UI에 동적으로 표현 될 데이터

프론트엔드 개발에서의 SideEffect란?
: 함수 또는 컴포넌트의 입력 외에도 함수의 결과에 영향을 미치는 요인

대표적인예 : 네트워크 요청(백엔드 API 요청)

React 의 주요 개발 원칙 중 하나는 UI를 페이지 단위가 아닌 컴포넌트 단위로 보는 것
상태의 두가지 구분

- 로컬 : 특정 컴포넌트 안에서만 관리되는 상태
  보통 컴포넌트 내에서만 영향을 끼치는 상태
  다른 컴포넌트와 데이터를 공유하지 않는 폼(form) 데이터는 대부분 로컬상태.
  Input box, select box등과 같이 입력 값을 받는 경우가 이에 해당.
- 전역 : 프로덕트 전체 혹은 여러 컴포넌트에서 관리되는 상태
  다른 컴포넌트와 상태를 공유하고 영향을 끼치는 상태이다. 장바구니에 담긴 물품의 경우, 상품 선택 여부에 따라 총 주문 금액을 업데이트 해야한다. 장바구니에 담긴 물품은 그 갯수 등을 다른 컴포넌트에 전달해 주어야 한다. 데이터 로딩여부 (로딩중..) 상태 역시, 앱 전반에 영향을 미친다.

서로 다른 컴포넌트가 사용하는 상태의 종류가 다르면, 꼭 전역 상태일 필요는 없다. 출처(source)가 달라도 된다.

그러나 서로 다른 컴포넌트가 동일한 상태를 다룬다면, 이 출처는 오직 한 곳이여야 한다. 만일 사본이 있을 경우, 두 데이터는 서로 동기화 (sync)하는 과정이 필요한데, 이는 문제를 어렵게 만든다.

❗️ 한 곳에서만 상태를 저장하고 접근해라

여기서 “하나의 출처”는 다른 말로 이야기하면 “전역공간” 이라고 볼 수 있다. 데이터 무결성을 위해, 동일한 데이터는 항상 같은 곳에서 데이터를 가지고 오도록 하자. Single source of truth(신뢰할 수 있는 단일 출처) 원칙은 프론트엔드 뿐만 아니라, 다양한 곳에서 언급되는 원칙이다.

> 데이터의 무결성이란 ?
>
> 데이터의 정확성을 보장하기 위해 데이터의 변경이나 수정 시 제한을 두어 안정성을 저해하는 요소를 막고 데이터 상태들을 항상 옳게 유지하는 것

데이터가 존재하고, 그 데이터를 보여줘야 하는 프론트엔드에서는 철저하게 우리가 위도한 대로 예외상황 없이 데이터를 잘 보여주어야 할 것이다. 우리가 보여주고자 하는 데이터가 있다면, 그 데이터가 어떤 경우에도 UI 상에 잘못 전달되는 일이 없게 만들어라.

전역상태 관리 Case study

전역으로 상태를 관리해야 하는 경우가 어떤 것이 있을까?

- 네이버를 비롯한 여러 사이트에서 다크모드. 이 경우 모든 페이지, 모든 컴포넌트에 다크 모드 혹은 라이트 모드가 적용이 되어야 하기 때문에 이러한 테마 설정을 전역으로 관리할 수도 있다.
- 국제화(Globalization) 설정도 마찬가지다. 사용자가 사용하는 브라우저나, 운영체제가 특정 언어를 사용하고 있음을 알아내서, UI에 필요한 텍스트 리소스를 따로 저장한 후 전역상태로 관리하기도 한다.

이 기능의 경우에도 모든 컴포넌트에서 사용자 언어로 표현이 되어야 하기 때문에 전역에서 상태 관리가 필요하죠.

### 상태관리 라이브러리가 어떤 문제를 해결해주는가?

1. 전역상태를 위한 저장소를 제공한다.
2. props drilling문제를 해결한다. (프로퍼티 내려꽂기)

# **Props Drilling이란**

`Props Drilling`은 상위 컴포넌트의 state를 props를 통해 전달하고자 하는 컴포넌트로 전달하기 위해 그 사이는 props를 전달하는 용도로만 쓰이는 컴포넌트들을 거치면서 데이터를 전달하는 현상을 의미한다. 컴포넌트 A의 state를 컴포넌트 D로 전달하기 위해선 사이에 있는 컴포넌트 B, C를 거쳐야한다.

# **Props Drilling의 문제점**

Props의 전달 횟수가 5회 이내로 많지 않다면 Props Drilling 은 큰 문제가 되지 않는다. 하지만 규모가 커지고 구조가 복잡해지면서 Props의 전달 과정이 늘어난다면 아래와 같은 문제가 발생한다.

- 코드의 가독성이 매우 나빠지게 된다.
- 코드의 유지보수 또한 힘들어지게 된다.
- state 변경시 Props 전달 과정에서 불필요하게 관여된 컴포넌트들 또한 리렌더링이 발생한다.
  따라서, 웹성능에 악영향을 줄 수 있다.

# **해결 방법**

과도한 `Props Drilling`을 방지하기 위한 방법으로는 컴포넌트와 관련있는 state는 될 수 있으면 가까이 유지하는 방법과 상태관리 라이브러리를 사용하는 방법이 있다. 상태관리 라이브러리를 사용하게 되면 전역으로 관리하는 저장소에서 직접 state를 꺼내쓸 수 있기 때문에 `Props Drilling`을 방지하기에 매우 효과적이다.
